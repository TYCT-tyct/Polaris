# Module 3: SpreadHunter — Elon 推文市场统计套利

> 纯市场微结构策略。不预测方向，赚盘口修复和流动性溢价的钱。
> 与 Module 4 的边界：Module 4 回答"Elon 会发多少条"，Module 3 回答"这个价格合不合理"。

---

## 一、策略定位

SpreadHunter 赚的不是"猜对了 Elon 发多少条"的钱，赚的是市场微结构中三种可重复的低风险利润：

| 利润来源 | 本质 | 类比 |
|---------|------|------|
| 开盘错价回归 | 散户冲击造成临时价格偏移 → 做市商修复后回归 | 超市清晨刚开门抢购后价格恢复 |
| 大单冲击回归 | 薄盘口上 $300+ 订单推动 3-8% 价移 → 5-30分钟内被修复 | 小池塘扔石头溅起的水花 |
| Spread 收敛 | 开盘期 spread 8-15% → 稳定后 2-4% → 在宽 spread 时做市 | 新商场刚开业时赚差价 |

**核心假设**：Elon 推文市场的单 bin 盘口深度通常只有 $500-3000。一笔 $300 的 market order 就能造成 3-5% 的临时偏移。这种偏移不反映信息变化，只反映流动性不足——因此大概率回归。

---

## 二、三种子策略的完整设计

### S1：开盘冲击回归

**触发条件**：新市场创建后的 T+0 到 T+6h。

**现象**：
- T+0 到 T+30m：最早的散户进入，通常是 Elon 粉丝，倾向于买高 bin → 高 bin 被推高
- T+30m 到 T+2h：更多散户 + 做市 bot 陆续进入
- T+2h 到 T+6h：做市商完全入场，spread 从 8-15% 收窄到 3-5%
- T+6h+：价格趋于稳定

**判断"价格异常"的方法（不需要预测模型）**：

用 `fact_settlement` 历史数据建立统计基准——过去 N 个同类型市场（7 天 or 3 天），稳定后（T+6h 到 T+24h）每个 bin 排位的中位数价格：

| bin 排位 | 稳定后价格中位数 | 1σ 范围 |
|---------|---------------|--------|
| 最高概率 bin | 0.24 | 0.18-0.30 |
| 第 2 高 | 0.19 | 0.14-0.24 |
| 第 3 高 | 0.15 | 0.10-0.20 |
| 其余 bin | 0.05-0.10 | — |

如果开盘时某 bin 被推到**2σ 以上**（比如最高 bin 被推到 0.38，而历史稳定中位数是 0.24）→ 高概率回归 → 卖 YES。

**交易规则**：
- 开盘后 T+30m 到 T+2h 之间观察
- 识别偏离 ≥2σ 的 bin → 反向操作
- 买入限价单，不追价
- 时间止损：如果 6h 内不回归 → 平仓认赔
- 止损幅度：-10%

**数据需求**（全部已有）：
- `dim_market` + `dim_token`：检测新市场创建
- `fact_quote_1m`：分钟级价格跟踪
- `fact_settlement` + 历史 `fact_quote_1m`：基准统计

**月利润预期**：$15-40（保守-正常）

---

### S2：大单冲击回归

**触发条件**：任何活跃市场中，某 bin 的 mid_price 在 1-3 分钟内变化 > 3%，同时 ask/bid 深度显著下降。

**检测逻辑**：
1. 持续监控所有活跃 bin 的 `fact_quote_top_raw`（best bid/ask/mid）
2. 计算 rolling 1-minute 价格变化
3. 同时检查 `fact_quote_depth_raw`：ask_depth_1pct 或 bid_depth_1pct 下降 > 40%
4. 两个条件同时满足 = 大单冲击事件

**区分"无信息冲击" vs "有信息冲击"**：

| 判据 | 无信息冲击 | 有信息冲击 |
|------|----------|----------|
| 影响范围 | 单一 bin 价格跳 | 多个 bin 同步调整 |
| XTracker 数据 | 推文速率无变化 | 推文速率突变 |
| 其他市场 | 不联动 | 相关市场同步动 |
| 时间点 | 随机 | 接近某个事件 |

只在判定为"无信息冲击"时交易。如果不确定 → 不做。

**交易规则**：
- 价格向上跳（有人大量买 YES）→ 卖 YES → 等回归
- 价格向下跳（有人大量卖 YES）→ 买 YES → 等回归
- 持仓上限：$30/次
- 时间止损：30 分钟内不回归 → 平仓
- 止损幅度：-8%

**月利润预期**：$12-32

---

### S3：Spread 做市

**触发条件**：活跃市场中，某 bin 的 spread > 4% 且盘口深度可接受。

**原理**：在 buy/sell 两端各挂一个限价单，买低卖高赚中间差价。Polymarket 的 maker 费用为 **0%**，你挂单成交不收费。

**操作**：
- 在 spread > 4% 的 bin 上挂双边限价单
- 买单 = 当前 best_bid + 0.01
- 卖单 = 当前 best_ask - 0.01
- 当买单成交 → 持有 YES → 等卖单成交 → 完成一轮来回
- 每轮赚 spread × 份额 的一部分

**关键风控**：
- **库存上限**：每 bin 最多持有 $50 的未对冲 YES
- **时间止损**：买了 YES 后 2h 没卖出 → 主动降低卖价
- **方向保护**：如果 mid_price 在你买入后下跌 > 5% → 砍仓
- **不做结算前 48h**：价格剧烈收敛期间不适合做市

**月利润预期**：$30-120（取决于成交率和竞争）

---

## 三、风控体系

### 策略级

| 规则 | S1 开盘 | S2 大单 | S3 做市 |
|------|--------|--------|--------|
| 单次仓位上限 | $50 | $30 | $50/bin |
| 最大持仓时间 | 6h | 30min | 4h |
| 单次止损 | -10% | -8% | -10% |
| 同时持仓数 | 3 bin | 2 bin | 5 bin |

### Module 级

| 规则 | 数值 |
|------|------|
| 日亏损上限 | $50 → 当天全停 |
| 周亏损上限 | $100 → 全停 + 人工审核 |
| 连续亏损 3 次 | 冷却 2 小时 |
| 总暴露上限 | 账户余额 40% |

---

## 四、盈利模型

| 策略 | 保守 | 正常 | 乐观 |
|------|------|------|------|
| S1 开盘冲击 | $15 | $25 | $40 |
| S2 大单回归 | $12 | $20 | $35 |
| S3 做市 | $30 | $80 | $120 |
| **Module 3 合计** | **$57** | **$125** | **$195** |

最坏场景（有纪律前提下）：月亏 $50 后系统停止。

---

## 五、服务器影响（52.49.214.146 / AWS Ireland）

| 策略 | 影响 | 原因 |
|------|------|------|
| S1 开盘 | 零 | 小时级操作 |
| S2 大单 | 轻微 | 需 5-30min 反应，70ms 延迟无影响 |
| S3 做市 | 可能轻微 | 挂单竞争在秒级，70ms 可接受 |

---

## 六、Module 协同时间表

| 市场阶段 | 时间 | 负责方 |
|---------|------|--------|
| 开盘混乱期 | T+0 到 T+6h | **Module 3** S1 |
| 全程 | 7×24h | **Module 3** S2+S3 |
| 稳定中段 | T+6h 到结算前 48h | **Module 4** 预测交易 |
| 结算前 | 最后 48h | **Module 2** 尾部收敛 |

---

## 七、开发路线

1. **Phase 0**（1 周）：接入 WebSocket 数据流，观察 2-3 个完整市场周期的盘口动态，不交易
2. **Phase 1**（2 周）：S2 大单检测 → paper trading
3. **Phase 2**（2 周）：S1 开盘回归 → paper trading
4. **Phase 3**（3 周）：S3 做市 → 小额 live

---

## 八、回测分析 (2026-02 Update)

基于 2 天的分钟级高频数据 (`analysis_final`) 分析结论：

### 1. 数据源致死缺陷 (S3 Blocked)
- `execution_features.csv` 显示 100% `BOOK_FAIL`。
- **影响**：当前数据管道无法获取实时 orderbook snapshot。
- **行动**：S3 (Spread 做市) 无法回测验证，也无法实盘运行，直到修复 Orderbook 数据源。必须优先解决数据接入问题。

### 2. S2 波动性验证与风控调整
- **高频波动**：在 2 天内检测到 **7442 次** >3% 的分钟级价格跳动。市场极度活跃。
- **回归率警示**：单纯的 "价格跳动即回归" 策略，下一分钟立即回归的概率仅为 **23.5%**。
- **结论**：绝大多数波动是趋势性的或由真实信息通过（推文发布）驱动的，而非纯流动性冲击。
- **修正**：S2 必须强制通过 Module 4 的 **Pattern Agent** 过滤。
    - **增加规则**：仅在 `Silence Flag = True` (过去 5 分钟无推文 && 预测未来 10 分钟无推文) 时启动 S2。
    - 在 Silence 期间的波动，才更有可能是流动性冲击。

### 3. 下一步建议
- **Phase 0 (New)** 重点转向：
    1. 修复 Orderbook Fetcher (针对 S3)。
    2. 实现 Pattern Agent 的 Silence Detector (针对 S2)。
